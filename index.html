<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEAR PLANT</title>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- <link rel="stylesheet" href="css/fullcalendar.css"> -->
    <link rel="stylesheet" href="css/calendar2.css">
    <link rel="stylesheet" href="css/slick.css" type="text/css" /> 
    <link rel="stylesheet" href="css/templatemo-style.css">
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap');
    </style>
<!--
    
TemplateMo 560 Astro Motion

https://templatemo.com/tm-560-astro-motion

-->
</head>
<body>
    <img src="video/main3.webp" loading="lazy" style="opacity: 0.85" alt="Image" height=100% id="bg-video">
    <!-- <video autoplay muted loop id="bg-video">
        <source src="video/main3.jpg" type="video/mp4">
    </video> -->
    <div class="page-container">
      <div class="container-fluid">
        <div class="row">
          <div class="col-xs-12">
            <div class="cd-slider-nav">
              <nav class="navbar navbar-expand-lg" id="tm-nav">
                <a class="nav-link" href="#0"><img src="img/dearplant_puple.webp" loading="lazy" alt="Image" width="170" height=auto></a>
                <!-- <a class="navbar-brand" href="#">Dear Plant</a> -->
                  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-supported-content" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                  </button>
                  <div class="collapse navbar-collapse" id="navbar-supported-content">
                    <ul class="navbar-nav mb-2 mb-lg-0">
                      <li class="nav-item selected">
                        <a class="nav-link" aria-current="page" href="#0" data-no="1">PLANT TALK</a>
                        <!-- <div class="circle"></div> -->
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#0" data-no="2">PLANT SOUND</a>
                        <!-- <div class="circle"></div> -->
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#0" data-no="3">MY DIARY</a>
                        <!-- <div class="circle"></div> -->
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#0" data-no="4">ABOUT US</a>
                        <!-- <div class="circle"></div> -->
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#0" data-no="5">CONTACT</a>
                        <!-- <div class="circle"></div> -->
                      </li>
                    </ul>
                  </div>
              </nav>
            </div>
          </div>          
        </div>        
      </div>

      <!-- Load Facebook SDK for JavaScript -->
      <div id="fb-root"></div>
      <script>
        window.fbAsyncInit = function() {
          FB.init({
            xfbml            : true,
            version          : 'v10.0'
          });
        };

        (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = 'https://connect.facebook.net/ko_KR/sdk/xfbml.customerchat.js';
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));</script>

      <!-- Your Chat Plugin code -->
      <div class="fb-customerchat"
        attribution="setup_tool"
        page_id="107060911473142">
      </div> 

      <div class="container-fluid tm-content-container">
        <ul class="cd-hero-slider mb-0 py-5">
          <li class="px-3" data-page-no="1">
            <div class="page-middle page-width-3">
              <div class="d-flex position-relative intro-container">
                <div class="tm-bg-dark content-pad page-width-1-1 intro-right">
                  <h4 class="mb-4"><b>식물의 메시지<br><br></b></h4>
                  <q class="mb-4 talk" id="plant_talk">나랑 대화나누자!</q>
                  <a><br><br></a>
                  <div class="text-center">
                    <p href="#0" id="read" class="btn2 btn2-primary tm-intro-btn">
                      link sensor
                    </p>
                  </div>        
                <!-- <div class="circle intro-circle-1"></div>
                <div class="circle intro-circle-2"></div>
                <div class="circle intro-circle-3"></div>
                <div class="circle intro-circle-4"></div> -->
              </div>
                      
            </div>            
          </li>
          <li data-page-no="2">
            <!-- Image Carousel -->
            <div class="mx-auto position-relative gallery-container">
              <!-- <div class="circle intro-circle-1"></div>
              <div class="circle intro-circle-2"></div> -->
              <div class="mx-auto gallery-slider">
                <figure class="effect-julia item" id="forest1">
                    <img src="img/forest1.webp" loading="lazy" alt="Image" id="forest1_img">
                    <figcaption>
                        <div>
                            <p>숲속으로 여행을 떠나보세요.</p>
                        </div>
                        <a href="#">View more</a>
                    </figcaption>
                </figure>
                <figure class="effect-julia item" id="river1">
                    <img src="img/river1.webp" loading="lazy" alt="Image" id="river1_img">
                    <figcaption>
                        <div>
                            <p>강가로 여행을 떠나보세요.</p>
                        </div>
                        <a href="#">View more</a>
                    </figcaption>
                </figure>
                <figure class="effect-julia item" id="cricket1">
                    <img src="img/cricket1.webp" loading="lazy" alt="Image" id="cricket1_img">
                    <figcaption>
                        <div>
                            <p>아늑한 시골로 여행을 떠나보세요.</p>
                        </div>
                        <a href="#">View more</a>
                    </figcaption>
                </figure>
                <figure class="effect-julia item" id="ocean1">
                    <img src="img/ocean1.webp" loading="lazy" alt="Image" id="ocean1_img">
                    <figcaption>
                        <div>
                            <p>바다로 여행을 떠나보세요.</p>
                        </div>
                        <a href="#">View more</a>
                    </figcaption>
                </figure>
                <figure class="effect-julia item" id="bird1">
                    <img src="img/bird1.webp" loading="lazy" alt="Image" id="bird1_img">
                    <figcaption>
                        <div>
                            <p>어여쁜 새가 바삐 움직이네요.</p>
                        </div>
                        <a href="#">View more</a>
                    </figcaption>
                </figure>
                <figure class="effect-julia item" id="bathtub1">
                    <img src="img/bathtub1.webp" loading="lazy" alt="Image" id="bathtub1_img">
                    <figcaption>
                        <div>
                            <p>욕조에 누워 편안히 책 읽어보는 거 어때요?</p>
                        </div>
                        <a href="#">View more</a>
                    </figcaption>
                </figure>
                <figure class="effect-julia item" id="rain1">
                    <img src="img/rain1.webp" loading="lazy" alt="Image" id="rain1_img">
                    <figcaption>
                        <div>
                            <p>지금 밖에 비가 오고 있어요.</p>
                        </div>
                        <a href="#">View more</a>
                    </figcaption>
                </figure>
                <figure class="effect-julia item" id="oven1">
                    <img src="img/oven1.webp" loading="lazy" alt="Image" id="oven1_img">
                    <figcaption>
                        <div>
                            <p>어떤 요리가 완성되고 있을까요?</p>
                        </div>
                        <a href="#">View more</a>
                    </figcaption>
                </figure>
                <figure class="effect-julia item" id="campfire1">
                    <img src="img/fire1.webp" loading="lazy" alt="Image" id="campfire1_img">
                    <figcaption>
                        <div>
                            <p>모닥불 소리를 들어보세요.</p>
                        </div>
                        <a href="#">View more</a>
                    </figcaption>
                </figure>
              </div>
            </div>
            <div class="text-center sound-button">
              <p href="#0" data-page-no="2" id="start" class="btn2 btn2-primary tm-intro-btn">
                play sound
              </p>
            </div> 
          </li>
          <li data-page-no="3" class="px-3">
            <div id='calendar'></div>   
          </li>
          <li data-page-no="4" class="px-3">
            <div class="position-relative page-width-1 page-middle">
              <!-- <div class="circle intro-circle-1"></div>
              <div class="circle intro-circle-2"></div>
              <div class="circle intro-circle-3"></div>
              <div class="circle intro-circle-4"></div> -->
              <div class="tm-bg-dark content-pad">
                <h4 class="mb-4"><b>DEAR PLANT</b></h4>
                <h5 class="mb-4">일상을 공유하는 나만의 식물 친구</h5>
                <p class="mb-4">
                  디어플랜트는 식물과 함께하는 챗봇 다이어리 서비스입니다.<br>
                  언제나 곁에 있으며 내 편으로서 나를 위로해주는 '식물 친구'를 만나보세요.
                </p>
                <p class="mb-0">
                  식물 친구가 전하는 위로의 한마디는 무엇일까요? <br><br> </p>
                <div class="intro-right intro-container">
                  <img src="img/home-img-1.webp" loading="lazy" style="opacity: 0.8" width=300 height=auto alt="Image" class="img-fluid intro-img-1">
                  <img src="img/home-img-2.webp" loading="lazy" style="opacity: 0.8" width=300 height=auto alt="Image" class="img-fluid intro-img-1">
                </div>
                <p rel="nofollow" href="https://dearplant.kr/" target="_blank" class="btn2 btn2-primary tm-intro-btn">
                  더 알아보기
                </p>
              </div>              
            </div>
          </li>
          <li data-page-no="5">
            <div class="mx-auto page-width-2">
              <div class="row">
                <div class="col-md-6 me-0 ms-auto">
                  <h4 class="mb-4"><b>Contact</b></h4>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 tm-contact-left">
                  <form action="#" method="POST" class="contact-form">
                    <div class="input-group tm-mb-30">
                        <input name="name" type="text" class="form-control rounded-0 border-top-0 border-end-0 border-start-0" placeholder="Name">
                    </div>
                    <div class="input-group tm-mb-30">
                        <input name="email" type="text" class="form-control rounded-0 border-top-0 border-end-0 border-start-0" placeholder="Email">
                    </div>
                    <div class="input-group tm-mb-30">
                        <textarea rows="5" name="message" class="textarea form-control rounded-0 border-top-0 border-end-0 border-start-0" placeholder="Message"></textarea>
                    </div>
                    <div class="input-group justify-content-end">
                        <input type="submit" class="btn3 btn3-primary tm-btn-pad-2" value="send">
                    </div>
                  </form>
                </div>
                <div class="col-md-6 tm-contact-right">                  
                  <p class="mb-4">
                    문의사항이나 알리고 싶은 내용이 있으면 뭐든지 주저말고 문의해주세요. 디어플랜트는 항상 여러분들의 목소리에 귀 기울이고 있습니다.
                  </p>
                  <div>
                    Tel. <a href="tel:010-7607-7135" class="tm-link-white">010-7607-7135 (Mon - Fri 10:30 - 17:30 / Lunch 13:00-14:00)</a>
                  </div>
                  <div class="tm-mb-45">
                    Email. <a href="dearplant.official@gmail.com" class="tm-link-white">dearplant.official@gmail.com</a>
                  </div>
                  <!-- Map -->
                  <div class="map-outer">
                    <div class="gmap-canvas">
                        <iframe width="100%" height="400" id="gmap-canvas"
                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d25700.226202052647!2d127.34955519519711!3d36.37220350473198!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x35654b7b74bef463%3A0xf5d5514e3ab64e3d!2z7Iuc7J6R7KCQ!5e0!3m2!1sko!2skr!4v1617891479831!5m2!1sko!2skr"
                            frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe>
                    </div>
                </div>
                </div>
              </div>
            </div>            
          </li>
        </ul>
    </div>
    <div class="container-fluid">
      <footer class="row mx-auto tm-footer">
        <div class="col-md-6 px-0">
        </div>
        <div class="col-md-6 px-0 tm-footer-right">
          <p>Copyright 2021 Dearplants Inc. All rights reserved.</p>
        </div>
      </footer>
    </div>
  </div>
  <!-- Preloader, https://ihatetomatoes.net/create-custom-preloading-screen/ -->
  <div id="loader-wrapper">            
    <div id="loader"></div>
    <div class="loader-section section-left"></div>
    <div class="loader-section section-right"></div>
  </div>  
  <script src="js/moment.min.js"></script>
  <script src="js/jquery-3.5.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/slick.js"></script>
  <script src="js/templatemo-script.js"></script>
  <script src="js/calendar2.js"></script>
  <!-- <script src="js/fullcalendar.js"></script> -->

  <script>
    var deviceName = 'PLITOR_AAA404'
    var bleService = '0000ffe0-0000-1000-8000-00805f9b34fb'
    var bleCharacteristic = '0000ffe1-0000-1000-8000-00805f9b34fb'
    var bluetoothDeviceDetected
    var gattCharacteristic
    var pre_value = -1
    var sound_play = false
    var base_sound = new Audio('sound/base1.mp3');
    var nature_sound = new Audio('sound/forest1.wav');
    var pre_click = "forest1_img"
    base_sound.volume = 0.5

    document.getElementById(pre_click).style.border="3px solid #7b3f91"
  
    document.body.style.backgroundColor = "#000000";
    document.querySelector('#read').addEventListener('click', function() {
      if (isWebBluetoothEnabled()) { read() }
    })
  
    document.querySelector('#start').addEventListener('click', function(event) {
      if (isWebBluetoothEnabled()) { sound_play = true }
    })
  
    // document.querySelector('#stop').addEventListener('click', function(event) {
    //   if (isWebBluetoothEnabled()) { stop() }
    // })

    document.querySelector('#forest1').addEventListener('click', function() {
      nature_sound = new Audio('sound/forest1.mp3');
      document.getElementById(pre_click).style.border="none"
      pre_click = "forest1_img"
      document.getElementById(pre_click).style.border="3px solid #7b3f91"
    })
    document.querySelector('#river1').addEventListener('click', function() {
      nature_sound = new Audio('sound/river1.mp3');
      document.getElementById(pre_click).style.border="none"
      pre_click = "river1_img"
      document.getElementById(pre_click).style.border="3px solid #7b3f91"
    })
    document.querySelector('#cricket1').addEventListener('click', function() {
      nature_sound = new Audio('sound/cricket1.mp3');
      document.getElementById(pre_click).style.border="none"
      pre_click = "cricket1_img"
      document.getElementById(pre_click).style.border="3px solid #7b3f91"
    })
    document.querySelector('#ocean1').addEventListener('click', function() {
      nature_sound = new Audio('sound/ocean1.mp3');
      document.getElementById(pre_click).style.border="none"
      pre_click = "ocean1_img"
      document.getElementById(pre_click).style.border="3px solid #7b3f91"
    })
    document.querySelector('#campfire1').addEventListener('click', function() {
      nature_sound = new Audio('sound/campfire1.mp3');
      document.getElementById(pre_click).style.border="none"
      pre_click = "campfire1_img"
      document.getElementById(pre_click).style.border="3px solid #7b3f91"
    })
    document.querySelector('#bird1').addEventListener('click', function() {
      nature_sound = new Audio('sound/bird1.mp3');
      document.getElementById(pre_click).style.border="none"
      pre_click = "bird1_img"
      document.getElementById(pre_click).style.border="3px solid #7b3f91"
    })
    document.querySelector('#oven1').addEventListener('click', function() {
      nature_sound = new Audio('sound/oven1.mp3');
      document.getElementById(pre_click).style.border="none"
      pre_click = "oven1_img"
      document.getElementById(pre_click).style.border="3px solid #7b3f91"
    })
    document.querySelector('#bathtub1').addEventListener('click', function() {
      nature_sound = new Audio('sound/bathtub1.mp3');
      document.getElementById(pre_click).style.border="none"
      pre_click = "bathtub1_img"
      document.getElementById(pre_click).style.border="3px solid #7b3f91"
    })
    document.querySelector('#rain1').addEventListener('click', function() {
      nature_sound = new Audio('sound/rain1.mp3');
      document.getElementById(pre_click).style.border="none"
      pre_click = "rain1_img"
      document.getElementById(pre_click).style.border="3px solid #7b3f91"
    })
    
  //   document.addEventListener('DOMContentLoaded', function() {
  //   var calendarEl = document.getElementById('calendar');

  //   var calendar = new FullCalendar.Calendar(calendarEl, {
  //     headerToolbar: {
  //       left: 'prev,next today',
  //       center: 'title',
  //       right: 'dayGridMonth,listMonth'
  //     },
  //     navLinks: true, // can click day/week names to navigate views
  //     editable: false,
  //     selectable: true,
  //     titleFormat: function (date) {
  //           // YYYY년 MM월
  //           return `${date.date.year}. ${date.date.month + 1}`;
  //         },
  //     dayNamesShort: ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'],
  //     events: [
  //       {
  //         title: 'Business Lunch',
  //         start: '2020-09-03T13:00:00',
  //         constraint: 'businessHours'
  //       },
  //       {
  //         title: 'Meeting',
  //         start: '2020-09-13T11:00:00',
  //         constraint: 'availableForMeeting', // defined below
  //         color: '#257e4a'
  //       },
  //       {
  //         title: 'Conference',
  //         start: '2020-09-18',
  //         end: '2020-09-20'
  //       },
  //       {
  //         title: 'Party',
  //         start: '2020-09-29T20:00:00'
  //       },

  //       // areas where "Meeting" must be dropped
  //       {
  //         groupId: 'availableForMeeting',
  //         start: '2020-09-11T10:00:00',
  //         end: '2020-09-11T16:00:00',
  //         display: 'background'
  //       },
  //       {
  //         groupId: 'availableForMeeting',
  //         start: '2020-09-13T10:00:00',
  //         end: '2020-09-13T16:00:00',
  //         display: 'background'
  //       },

  //       // red areas where no events can be dropped
  //       {
  //         start: '2020-09-24',
  //         end: '2020-09-28',
  //         overlap: false,
  //         display: 'background',
  //         color: '#ff9f89'
  //       },
  //       {
  //         start: '2020-09-06',
  //         end: '2020-09-08',
  //         overlap: false,
  //         display: 'background',
  //         color: '#ff9f89'
  //       }
  //     ]
  //   });

  //   calendar.render();
  // });
  
    function isWebBluetoothEnabled() {
      if (!navigator.bluetooth) {
        console.log('Web Bluetooth API is not available in this browser!')
        return false
      }
  
      return true
    }
  
    function getDeviceInfo() {
      let options = {
        optionalServices: [bleService],
        filters: [
          { "name": deviceName }
        ]
      }
  
      console.log('Requesting any Bluetooth Device...')
      return navigator.bluetooth.requestDevice(options).then(device => {
        bluetoothDeviceDetected = device
      }).catch(error => {
        console.log('Argh! ' + error)
      })
    }
  
    function read() {
      return (bluetoothDeviceDetected ? Promise.resolve() : getDeviceInfo())
      .then(connectGATT)
      .then(_ => {
        console.log('Reading Value...')
        return gattCharacteristic[0].readValue()
      })
      .catch(error => {
        console.log('Waiting to start reading: ' + error)
      })
    }
  
    function connectGATT() {
      if (bluetoothDeviceDetected.gatt.connected && gattCharacteristic) {
        return Promise.resolve()
      }
  
      return bluetoothDeviceDetected.gatt.connect()
      .then(server => {
        console.log('Getting GATT Service...')
        return server.getPrimaryService(bleService)
      })
      .then(service => {
        console.log('Getting GATT Characteristic...')
        return service.getCharacteristics(bleCharacteristic)
      })
      .then(characteristic => {
        gattCharacteristic = characteristic
        console.log(gattCharacteristic)
        document.getElementById("plant_talk").innerHTML = "<br>아이 심심해 <br><br> 근데 나 목말라..물 좀 줄래?<br>"; 
        document.getElementById("read").style.display = "none"
        gattCharacteristic[0].addEventListener('characteristicvaluechanged',
            handleChangedValue)
        document.querySelector('#start').disabled = false
        start()
      })
    }
  
    function handleChangedValue(event) {
      let value = event.target.value.getInt8(0)
      var now = new Date()
      console.log('> ' + now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds() + ' Value is ' + value)
      const Http = new XMLHttpRequest();
      var url='https://api.dearplants.co.kr/chat/chatfuel/default_answer?state=' + String(value) + '&device_id=' + deviceName.slice(7);
      Http.open("GET", url);
      Http.send();
  
      Http.onreadystatechange = (e) => {
        console.log(Http.responseText)
      }
      if (value == 1) {
          nature_sound.pause()
          document.getElementById("plant_talk").innerHTML = "나 목이 타들어갈 거 같아...물마시고 싶어<br>"; 
        } else if (value == 2){
          document.getElementById("plant_talk").innerHTML = "<br>반가워:) 오랜만이야<br>"; 
          base_sound.play()
        } else if (value == 3){
          document.getElementById("plant_talk").innerHTML = "<br>히히 간지럽다>_< <br><br> 근데 나 목말라..물 좀 줄래?<br>"; 
          nature_sound.play()
        } 
      pre_value = value
    }
  
    function start() {
      gattCharacteristic[0].startNotifications()
      .then(_ => {
        console.log('Start reading...')
        document.querySelector('#start').disabled = true
        document.querySelector('#stop').disabled = false
      })
      .catch(error => {
        console.log('[ERROR] Start: ' + error)
      })
    }
  
    function stop() {
      gattCharacteristic[0].stopNotifications()
      .then(_ => {
        console.log('Stop reading...')
        document.querySelector('#start').disabled = false
        document.querySelector('#stop').disabled = true
      })
      .catch(error => {
        console.log('[ERROR] Stop: ' + error)
      })
    }
  
    function stop() {
      base_sound.pause()
      fire_sound.pause()
      cricket_sound.pause()
      cricket_status = false
      fire_status = false
    }
  </script>

</body>
</html>